<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineMatrix - Bookings</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script
      src="https://kit.fontawesome.com/2c36e9b7b1.js"
      crossorigin="anonymous"
    ></script>
    <style>
      * {
        box-sizing: border-box;
      }

      h1 {
        font-size: 2.5rem;
      }

      .seat {
        width: 30px;
        height: 25px;
        border: 1px solid #000;
        background-color: #616d7e;
        cursor: pointer;
        margin: 3px;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        transition: all 0.3s ease;
      }

      .seat.occupied {
        background-color: #7c0a02;
      }

      .seat.occupied:hover {
        background-color: #ea3c53;
      }

      .seat:hover {
        background-color: #a9a9a9;
      }

      .seat.selected {
        background-color: #0f4c75;
      }

      .seat.selected:hover {
        background-color: #0f4c75;
      }

      .seats {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        height: fit-content;
        justify-content: center;
        align-items: center;
      }

      .seat:nth-of-type(2) {
        margin-right: 10px;
      }

      .seat:not(.occupied):hover {
        scale: 1.2;
        cursor: pointer;
      }

      .showcase {
        padding: 5px 10px;
        border-radius: 10px;
        opacity: 0.8;
        color: #fff;
        font-size: 1.2rem;
        font-weight: 500;
        margin: 10px 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .showcase li {
        display: flex;
        align-items: center;
        margin-right: 10px;
        justify-content: center;
        margin: 0 10px;
      }

      .showcase li small {
        margin-left: 10px;
      }
    </style>
  </head>

  <body>
    <!--navbar-->
    <nav
      class="relative w-full flex flex-wrap items-center justify-between py-4 bg-gray-800 text-gray-500 hover:text-gray-700 focus:text-gray-700 shadow-lg"
    >
      <div
        class="container-fluid w-full flex flex-wrap items-center justify-between px-6"
      >
        <div
          class="w-full relative flex justify-between lg:w-auto lg:static lg:block lg:justify-start"
        >
          <a
            href="#"
            class="text-sm font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white"
          >
            <img
              src="/images/icon.svg"
              alt="logo"
              class="h-8 w-8 inline-block"
            />
            Cinematrix
          </a>
          <button
            class="cursor-pointer text-xl leading-none px-3 py-1 border border-solid border-transparent rounded bg-transparent block lg:hidden outline-none focus:outline-none"
            type="button"
            onclick="toggleNavbar('example-collapse-navbar')"
            id="nav-button-icon"
          >
            <i class="fas fa-bars" style="color: #fff" id="nav-icon"></i>
          </button>
        </div>
        <div
          class="lg:flex flex-grow items-center bg-gray-800 lg:bg-transparent lg:shadow-none hidden"
          id="example-collapse-navbar"
        >
          <ul class="flex flex-col lg:flex-row list-none lg:ml-auto">
            <li class="flex items-center">
              <a
                class="px-3 py-2 flex items-center text-xs uppercase font-bold leading-snug text-white hover:opacity-75"
                href="/"
                ><i
                  class="fas fa-home text-lg leading-lg text-white opacity-75"
                ></i
                ><span class="ml-2">Home</span></a
              >
            </li>
            <li class="flex items-center">
              <a
                class="px-3 py-2 flex items-center text-xs uppercase font-bold leading-snug text-white hover:opacity-75"
                href="/about"
                ><i
                  class="fas fa-info-circle text-lg leading-lg text-white opacity-75"
                ></i
                ><span class="ml-2">About</span></a
              >
            </li>
            <li class="flex items-center">
              <a
                class="px-3 py-2 flex items-center text-xs uppercase font-bold leading-snug text-white hover:opacity-75"
                href="/contact"
                ><i
                  class="fas fa-phone text-lg leading-lg text-white opacity-75"
                ></i
                ><span class="ml-2">Contact</span></a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!--end of navbar-->
    <!--main-->
    <!--movie info, name price total seats booked length-->
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 bg-gray-700"
    >
      <div class="col-span-1">
        <img
          class="w-48 h-64 mx-auto"
          alt="movie poster"
          id="movie"
          src="https://image.tmdb.org/t/p/w500/7WsyChQLEftFiDOVTGkv3hFpyyt.jpg"
        />
      </div>
      <div class="col-span-3">
        <div class="px-4 py-5 sm:px-6">
          <h3 class="text-lg leading-6 font-medium text-white" id="movie-name">
            Movie Name
          </h3>
          <p
            class="mt-1 max-w-2xl text-sm text-gray-300"
            id="movie-description"
          >
            Movie Description
          </p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-0">
          <dl class="sm:divide-y sm:divide-gray-200">
            <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
              <dt class="text-sm font-medium text-gray-100">Total Price</dt>
              <dd
                class="mt-1 text-sm text-gray-100 sm:mt-0 sm:col-span-2"
                id="movie-total-price"
              >
                Price
              </dd>
            </div>
            <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
              <dt class="text-sm font-medium text-gray-100">Date and Time</dt>
              <dd
                class="mt-1 text-sm text-gray-100 sm:mt-0 sm:col-span-2"
                id="movie-date"
              >
                Date and Time
              </dd>
            </div>
            <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
              <dt class="text-sm font-medium text-gray-100" id="total-price">
                Duration
              </dt>
              <dd
                class="mt-1 text-sm text-gray-100 sm:mt-0 sm:col-span-2"
                id="movie-duration"
              >
                Duration
              </dd>
            </div>
          </dl>
        </div>
      </div>
    </div>
    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 bg-gray-700"
    >
      <!--paypal information-->
      <div class="col-span-1">
        <div class="px-4 py-5 sm:p-6">
          <h3 class="text-lg leading-6 font-medium text-white">Paypal</h3>
          <div class="mt-2 max-w-xl text-sm text-gray-300">
            <p>Payment Details.</p>
          </div>
          <div class="mt-5">
            <form action="#" method="POST">
              <div class="shadow overflow-hidden sm:rounded-md">
                <div class="px-4 py-5 bg-white sm:p-6">
                  <div class="grid grid-cols-6 gap-6">
                    <div class="col-span-6 sm:col-span-3">
                      <label
                        for="first-name"
                        class="block text-sm font-medium text-gray-700"
                        >First name</label
                      >
                      <input
                        type="text"
                        name="first-name"
                        id="first-name"
                        autocomplete="first-name"
                        readonly
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                      />
                    </div>

                    <div class="col-span-6 sm:col-span-3">
                      <label
                        for="last-name"
                        class="block text-sm font-medium text-gray-700"
                        >Last name</label
                      >
                      <input
                        type="text"
                        name="last-name"
                        id="last-name"
                        autocomplete="family-name"
                        readonly
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                      />
                    </div>

                    <div class="col-span-6 sm:col-span-4">
                      <label
                        for="email-address"
                        class="block text-sm font-medium text-gray-700"
                        >Email address</label
                      >
                      <input
                        type="text"
                        name="email-address"
                        id="email-address"
                        autocomplete="email"
                        readonly
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                      />
                    </div>

                    <div class="col-span-6 sm:col-span-3">
                      <label
                        for="country"
                        class="block text-sm font-medium text-gray-700"
                        >Country / Region</label
                      >
                      <input
                        type="text"
                        name="country"
                        id="country"
                        autocomplete="country"
                        readonly
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                      />
                      <!--address-->
                      <div class="mt-1">
                        <label
                          for="address"
                          class="block text-sm font-medium text-gray-700"
                          >Address</label
                        >
                        <input
                          type="text"
                          name="address"
                          id="address"
                          autocomplete="address"
                          readonly
                          class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                        />
                      </div>
                      <div class="mt-1">
                        <label
                          for="address2"
                          class="block text-sm font-medium text-gray-700"
                          >Address 2</label
                        >
                        <input
                          type="text"
                          name="address2"
                          id="address2"
                          autocomplete="address2"
                          readonly
                          class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                        />
                      </div>
                      <div class="mt-1">
                        <label
                          for="city"
                          class="block text-sm font-medium text-gray-700"
                          >City</label
                        >
                        <input
                          type="text"
                          name="city"
                          id="city"
                          autocomplete="city"
                          readonly
                          class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-span-1">
        <div class="flex flex-col">
          <h1 class="text-2xl font-bold text-white">
            Show this qr code to the ticket counter
          </h1>
          <div class="flex justify-center">
            <img alt="qr-code" class="w-full" id="image" />
          </div>
          <div class="flex justify-center">
            <button
              type="button"
              class="inline-flex items-center px-6 py-5 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
            >
              Download QR Code
            </button>
          </div>
        </div>
      </div>
      <!--seats selected-->
      <div class="col-span-1">
        <h1 class="text-2xl font-bold text-white">Seats Selected</h1>
        <ul class="showcase">
          <li>
            <div class="seat"></div>
            <small>Available</small>
          </li>
          <li>
            <div class="seat selected"></div>
            <small>Selected</small>
          </li>
          <li>
            <div class="seat occupied"></div>
            <small>Occupied</small>
          </li>
        </ul>
        <div class="seats">
          <div class="seatRow">
            <div class="seat" id="seat1A"></div>
            <div class="seat" id="seat1B"></div>
            <div class="seat" id="seat1C"></div>
            <div class="seat" id="seat1D"></div>
            <div class="seat" id="seat1E"></div>
            <div class="seat" id="seat1F"></div>
            <div class="seat" id="seat1G"></div>
            <div class="seat" id="seat1H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat2A"></div>
            <div class="seat" id="seat2B"></div>
            <div class="seat" id="seat2C"></div>
            <div class="seat" id="seat2D"></div>
            <div class="seat" id="seat2E"></div>
            <div class="seat" id="seat2F"></div>
            <div class="seat" id="seat2G"></div>
            <div class="seat" id="seat2H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat3A"></div>
            <div class="seat" id="seat3B"></div>
            <div class="seat" id="seat3C"></div>
            <div class="seat" id="seat3D"></div>
            <div class="seat" id="seat3E"></div>
            <div class="seat" id="seat3F"></div>
            <div class="seat" id="seat3G"></div>
            <div class="seat" id="seat3H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat4A"></div>
            <div class="seat" id="seat4B"></div>
            <div class="seat" id="seat4C"></div>
            <div class="seat" id="seat4D"></div>
            <div class="seat" id="seat4E"></div>
            <div class="seat" id="seat4F"></div>
            <div class="seat" id="seat4G"></div>
            <div class="seat" id="seat4H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat5A"></div>
            <div class="seat" id="seat5B"></div>
            <div class="seat" id="seat5C"></div>
            <div class="seat" id="seat5D"></div>
            <div class="seat" id="seat5E"></div>
            <div class="seat" id="seat5F"></div>
            <div class="seat" id="seat5G"></div>
            <div class="seat" id="seat5H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat6A"></div>
            <div class="seat" id="seat6B"></div>
            <div class="seat" id="seat6C"></div>
            <div class="seat" id="seat6D"></div>
            <div class="seat" id="seat6E"></div>
            <div class="seat" id="seat6F"></div>
            <div class="seat" id="seat6G"></div>
            <div class="seat" id="seat6H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat7A"></div>
            <div class="seat" id="seat7B"></div>
            <div class="seat" id="seat7C"></div>
            <div class="seat" id="seat7D"></div>
            <div class="seat" id="seat7E"></div>
            <div class="seat" id="seat7F"></div>
            <div class="seat" id="seat7G"></div>
            <div class="seat" id="seat7H"></div>
          </div>
          <div class="seatRow">
            <div class="seat" id="seat8A"></div>
            <div class="seat" id="seat8B"></div>
            <div class="seat" id="seat8C"></div>
            <div class="seat" id="seat8D"></div>
            <div class="seat" id="seat8E"></div>
            <div class="seat" id="seat8F"></div>
            <div class="seat" id="seat8G"></div>
            <div class="seat" id="seat8H"></div>
          </div>
        </div>
      </div>
    </div>
    <!--end of movie info-->
    <!--footer-->
    <footer class="bg-gray-800">
      <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
        <nav
          class="-mx-5 -my-2 flex flex-wrap justify-center"
          aria-label="Footer"
        >
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              About
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Blog
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Jobs
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Press
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Partners
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Contact Us
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Privacy
            </a>
          </div>
          <div class="px-5 py-2">
            <a href="#" class="text-base text-gray-400 hover:text-gray-300">
              Terms
            </a>
          </div>
        </nav>
      </div>
    </footer>
    <!--end of footer-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/jquery@3.6.1/dist/jquery.min.js"></script>
    <script>
      function getUrlParams() {
        var params = {};
        window.location.search.replace(
          /[?&]+([^=&]+)=([^&]*)/gi,
          function (str, key, value) {
            params[key] = value;
          }
        );
        return params;
      }
      function convertDate(date) {
        //convert date to english format
        let months = {
          1: "January",
          2: "February",
          3: "March",
          4: "April",
          5: "May",
          6: "June",
          7: "July",
          8: "August",
          9: "September",
          10: "October",
          11: "November",
          12: "December",
        };
        let numberToEnglish = {
          1: "First",
          2: "Second",
          3: "Third",
          4: "Fourth",
          5: "Fifth",
          6: "Sixth",
          7: "Seventh",
          8: "Eighth",
          9: "Ninth",
          10: "Tenth",
          11: "Eleventh",
          12: "Twelfth",
          13: "Thirteenth",
          14: "Fourteenth",
          15: "Fifteenth",
          16: "Sixteenth",
          17: "Seventeenth",
          18: "Eighteenth",
          19: "Nineteenth",
          20: "Twentieth",
          21: "Twenty first",
          22: "Twenty second",
          23: "Twenty third",
          24: "Twenty fourth",
          25: "Twenty fifth",
          26: "Twenty sixth",
          27: "Twenty seventh",
          28: "Twenty eighth",
          29: "Twenty ninth",
          30: "Thirtieth",
          31: "Thirty first",
        };
        let month = date.split("/")[0];
        let day = date.split("/")[1];

        return numberToEnglish[day] + " " + months[month];
      }
      function convertTime(time) {
        //convert time to english format
        let hours = time.split(":")[0];
        let minutes = time.split(":")[1];
        let ampm = hours >= 12 ? "pm" : "am";
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        let strTime = hours + ":" + minutes + " " + ampm;
        return strTime;
      }
      function getBookInfo(callback) {
        const id = getUrlParams().bookId;
        const movieId = getUrlParams().movieId;
        axios
          .get(`/api/v1/booking/${movieId}/${id}`, {
            headers: {
              "Content-Type": "application/json",
            },
          })

          .then((response) => {
            const book = response.data;
            console.log(book)
            callback(book);
          })
          .catch((error) => {
            console.log(error);
          });
      }
      function getMovieInfo(callback) {
        const id = getUrlParams().movieId;
        axios
          .get(`/api/v1/movie/${id}`)
          .then((response) => {
            const movie = response.data;
            callback(movie);
          })
          .catch((error) => {
            console.log(error);
          });
      }
      function GenerateCode(bookId) {
        axios
          .get("/api/v1/qrcode/" + bookId)
          .then((response) => {
            const qrcode = response.data;
            $("#image").attr("src", qrcode);
          })
          .catch((error) => {
            console.log(error);
          });
      }
      function setSeats(seats) {
        console.log(seats);
        seats.forEach((seat) => {
          $(`#${seat}`).addClass("selected");
        });
      }
      getBookInfo((book) => {
        const movieId = getUrlParams().movieId;
        const bookId = getUrlParams().bookId;
        getMovieInfo((movie) => {
        
          GenerateCode(bookId);
          console.log(book);
          setSeats(book.seats);
          const ticketPrice = 10;
          const total = book.seats.length * ticketPrice;
          $("#movie-name").text(movie.name);
          $("#movie-description").text(movie.description);
          $("#movie").attr("src", movie.image);

          $("#movie-total-price").text("Total: " + total + " $");
          $("#movie-duration").text("Duration: " + movie.duration);

          $("#email-address").val(book.orderDetails.payer.email_address);
          $("#first-name").val(book.orderDetails.payer.name.given_name);
          $("#last-name").val(book.orderDetails.payer.name.surname);
          $("#address").val(
            book.orderDetails.purchase_units[0].shipping.address.address_line_1
          );
          $("#country").val(
            book.orderDetails.purchase_units[0].shipping.address.country_code
          );
          $("#city").val(
            book.orderDetails.purchase_units[0].shipping.address.admin_area_2
          );
        });
      });
      $("#download").click(function () {
        var img = document.getElementById("image");
        var a = document.createElement("a");
        a.href = img.src;
        a.download = img.src;
        a.click();
      });
      function toggleNavbar(collapseID) {
        document.getElementById(collapseID).classList.toggle("hidden");
        document.getElementById(collapseID).classList.toggle("block");
        const icon = document.getElementById("nav-icon");
        if (icon.classList.contains("fa-bars")) {
          icon.classList.remove("fa-bars");
          icon.classList.add("fa-times");
        } else {
          icon.classList.remove("fa-times");
          icon.classList.add("fa-bars");
        }
      }
    </script>
  </body>
</html>
